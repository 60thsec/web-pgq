<div class="transparent top attached small tabular ui menu">
	<a class="item" ng-class="{active: (resultsTab == 'Results')}" ng-click="showResults()">
		<i class="table icon"></i>
		Results
	</a>
	<a class="item" ng-class="{active: (resultsTab == 'Geometry')}" ng-click="showGeometry()">
		<i class="map icon" ng-class="{loading: geometryLoading}"></i>
		Geometry
	</a>
	<a class="item" ng-class="{active: (resultsTab == 'Query Plan')}" ng-click="showPlan()">
		<i class="sitemap icon"></i>
		Query Plan
	</a>
	<a class="item" ng-class="{active: (resultsTab == 'Messages')}" ng-click="showMessages()">
		<i class="browser icon"></i>
		Messages
	</a>
</div>

<div id="resultsTabs" class="dimmable attached ui segment">

	<div class="ui dimmer" ng-class="{active: (resultsTab == 'Query Plan')}" id="plan-diagram-dimmer">
		<div class="top left attached ui labels">
			<a class="small compact squarish green ui label" data-content="Zoom to fit"
					ng-click="zoomFit()">
				<i class="maximize icon"></i>
			</a>
			<a class="small compact teal dropdown ui label">
				<span>Line width:</span>
				<span class="detail" ng-class="{fallback: lineWidthKey != selectedLineWidthKey}">{{ lineWidthKey }}</span>

				<i class="dropdown icon"></i>
				<div class="menu">
					<div class="item" ng-repeat="planKey in groupedPlanKeys"
							ng-class="{active: selectedLineWidthKey == planKey || contains(planKey.keys, selectedLineWidthKey)}"
							ng-click="setLineWidthKey(planKey)">
						<i ng-if="planKey.keys" class="dropdown icon"></i>
						<span>{{ planKey.title || planKey }}</span>

						<div class="menu" ng-if="planKey.keys">
							<div class="item" ng-repeat="groupedPlanKey in planKey.keys"
									ng-class="{active: selectedLineWidthKey == groupedPlanKey}"
									ng-click="setLineWidthKey(groupedPlanKey)">
								{{ groupedPlanKey }}
							</div>
						</div>
					</div>
				</div>

				<span ng-show="graph.edgeLabelLegend" class="edgeLabelLegend fade animation">Labels:
						<em>{{ graph.edgeLabelLegend }}</em></span>
			</a>
		</div>

		<div class="content">
			<svg digraph graph="graph" class="fill-parent">
				<defs>
					<g ng-repeat="node in graphNodes" id="{{ node.useDef }}">
						<image xlink:href="{{ node.iconURL }}" x="-32" y="-32" width="64px" height="64px"></image>
					</g>
				</defs>
			</svg>
		</div>
	</div>

	<div id="geometry-map" ng-class="{visible: resultsTab == 'Geometry'}">
		<div class="top left attached ui labels">
			<div id="layers-button" class="green dropdown ui label">
				Layers
				<i class="dropdown icon"></i>

				<div id="layers-dropdown" class="small vertical menu">
					<a class="item" ng-repeat="layer in availableLayers"
							ng-click="eatEvent($event, layer.toggle)"
							ng-class="{active: layer.active, teal: layer.active}">

						<i class="color icon" ng-if="layer.htmlColor" ng-style="{'background-color': layer.htmlColor}"></i>
						{{ layer.display || layer.name }}
						<em ng-if="layer.queryID">(query # {{layer.queryID}})</em>

						<div class="squarish check ui label" ng-class="{teal: val.enabled}">
							<i class="icon" ng-class="{disabled: !layer.active, checkmark: layer.active}"></i>
						</div>

						<div class="squarish teal clickable ui label" ng-class="{disabled: !layer.hasExtent}"
								title="Zoom to fit" ng-click="eatEvent($event, layer.center)">
							<i class="left map icon"></i>
						</div>
					</a>
				</div>
			</div>
		</div>

		<openlayers center="geomMapCenter">
			<ol-layer ol-layer-properties="layer" ng-repeat="layer in availableLayers|filter:{active:true}"></ol-layer>
		</openlayers>
	</div>

	<div class="ui dimmer" ng-class="{active: (resultsTab == 'Messages')}" id="messages-dimmer">
		<div class="top right attached ui labels">
			<a class="small compact squarish ui label" ng-class="{black: logger.showBannersFor.debug}"
					ng-click="logger.showBannersFor.debug = !logger.showBannersFor.debug">
				<i class="bug icon" ng-class="{black: !logger.showBannersFor.debug, disabled: !logger.showBannersFor.debug}"></i>
			</a>
			<a class="small compact squarish ui label" ng-class="{teal: logger.showBannersFor.info}"
					ng-click="logger.showBannersFor.info = !logger.showBannersFor.info">
				<i class="info letter icon" ng-class="{teal: !logger.showBannersFor.info, disabled: !logger.showBannersFor.info}"></i>
			</a>
			<a class="small compact squarish ui label" ng-class="{green: logger.showBannersFor.success}"
					ng-click="logger.showBannersFor.success = !logger.showBannersFor.success">
				<i class="checkmark icon" ng-class="{green: !logger.showBannersFor.success, disabled: !logger.showBannersFor.success}"></i>
			</a>
			<a class="small compact squarish ui label" ng-class="{yellow: logger.showBannersFor.warning}"
					ng-click="logger.showBannersFor.warning = !logger.showBannersFor.warning">
				<i class="warning sign icon" ng-class="{yellow: !logger.showBannersFor.warning, disabled: !logger.showBannersFor.warning}"></i>
			</a>
			<a class="small compact squarish ui label" ng-class="{red: logger.showBannersFor.error}"
					ng-click="logger.showBannersFor.error = !logger.showBannersFor.error">
				<i class="remove circle icon" ng-class="{red: !logger.showBannersFor.error, disabled: !logger.showBannersFor.error}"></i>
			</a>
		</div>

		<div class="left aligned inverted content">
			<section>
				<div class="fade slide animation small icon ui message" ng-class="banner.severity"
						ng-repeat="(idx, banner) in logger.bannerMessages">
					<i class="icon" ng-class="banner.icon"></i>
					<div class="mini floating ui label">
						{{ banner.time | date:"h:mm a" }}
						<div class="detail">{{ banner.time | date:"M/d/y" }}</div>
					</div>
					<div class="content">
						<div class="header">
							{{ banner.header }}
						</div>
						<div class="ui accordion" ng-if="banner.detail">
							<strong class="title"><i class="dropdown icon"></i>Details &#x2026;</strong>
							<pre class="content" ng-if="banner.detailType == 'string'"><code>{{ banner.detail }}</code></pre>
							<ul class="content list" ng-if="banner.detailType != 'string'">
								<li ng-repeat="(key, val) in banner.detail"
										ng-class="{ui: isMultiLineString(val), accordion: isMultiLineString(val)}">

									<strong ng-if="!isMultiLineString(val)">{{ key }}:</strong>
									<strong class="title" ng-if="isMultiLineString(val)">{{ key }} &#x2026;</strong>

									<pre ng-if="!isString(val)" ng-class="{content: isMultiLineString(val)}"><code>{{ val|json }}</code></pre>
									<pre ng-if="isString(val)" ng-class="{content: isMultiLineString(val)}"><code>{{ val }}</code></pre>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</section>
		</div>
	</div>

	<div id="resultsContainer">
		<div class="padding">
			<div ng-repeat="resultSet in resultSets track by $index" class="resultSet">

				<sticky context="#resultsContainer" scrollContext="#resultsContainer" class="small dividing ui header">
					Result Set {{ $index + 1 }} / {{ resultSets.length }}

					<div class="tiny right floated ui header">
						<div class="small compact ui label">
							Rows <div class="detail">{{ resultSet.rowCount || 0 }}</div>
						</div>
						<div class="small compact ui label" ng-if="resultSet && resultSet.affectedRowCount">
							Affected <div class="detail">{{ resultSet.affectedRowCount }}</div>
						</div>
						<div class="small compact ui label" ng-if="resultSet && resultSet.totalTimeMS">
							<div class="left detail">{{ resultSet.totalTimeMS }}</div> <span>ms</span>
						</div>
					</div>
				</sticky>

				<div ng-if="!query.running && resultSet.rows.length == 0 && resultsTab == 'Results'"
						class="fast fade animation red ribbon ui label">
					No rows returned.
				</div>

				<table ng-if="resultSet.rows.length > 0"
						class="fade animation compact collapsing celled bottom attached ui table">

					<thead>
						<tr>
							<th ng-repeat="field in resultSet.fields track by $index"
								title="Data Type: {{ field.dataType }}">{{ field.name }}</th>
						</tr>
					</thead>

					<tbody>
						<!--tr ng-repeat="row in resultSet.rows track by $index" class="fade animation">
							<td ng-repeat="value in row track by $index"
								result-value="value" result-field-type="resultSet.fields[$index].dataType"
								ace-config="commonEditorConfig">
							</td>
						</tr-->
						<tr ng-repeat="row in resultSet.rows track by $index">
							<td ng-repeat="value in row track by $index"
								result-value="value" result-field-type="resultSet.fields[$index].dataType">
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>

	<div class="hiding bottom right attached ui labels" ng-class="{black: resultsTab == 'Messages'}">
		<div class="small compact ui label" ng-if="resultSets && resultSets.status">
			{{ resultSets.status|capitalizeWords }}
		</div>
		<div class="small compact ui label">
			Statements <div class="detail">{{ resultSets.length || 0 }}</div>
		</div>
		<div class="small compact ui label">
			Total Rows <div class="detail">{{ resultSets.totalRows || 0 }}</div>
		</div>
		<div class="small compact ui label" ng-if="resultSets && resultSets.totalRowsAffected">
			Total Affected <div class="detail">{{ resultSets.totalRowsAffected }}</div>
		</div>
		<div class="small compact ui label" ng-if="resultSets && resultSets.totalTimeMS">
			<div class="left detail">{{ resultSets.totalTimeMS }}</div> ms
		</div>
	</div>
</div>
